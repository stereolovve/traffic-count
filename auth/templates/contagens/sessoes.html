{% extends "base.html" %}
{% load static %}

{% block title %}Sessões de Contagem - Traffic Count{% endblock %}

{% block page_title %}Sessões de Contagem{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="{% static 'css/pages/sessoes.css' %}">
{% endblock %}

{% block content %}
<div class="space-y-6 min-h-screen bg-gray-900">
    <!-- Compact Expandable Filters Section -->
    <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 overflow-hidden filter-container">
        <!-- Compact Filter Header -->
        <div class="filter-header bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4" onclick="toggleFilters()">
            <div class="flex items-center justify-between text-white">
                <div class="flex items-center">
                    <i class="fas fa-filter mr-3 text-lg"></i>
                    <h2 class="text-lg font-bold">Filtros</h2>
                    <!-- Show active filter count -->
                    {% if filtros_ativos.status or filtros_ativos.pesquisador or filtros_ativos.codigo or filtros_ativos.ponto or filtros_ativos.data or filtros_ativos.padrao %}
                        <span class="ml-3 bg-white text-blue-600 px-2 py-1 rounded-full text-xs font-semibold">
                            {{ filtros_ativos|length }} ativo{{ filtros_ativos|length|pluralize:"s" }}
                        </span>
                    {% endif %}
                </div>
                <div class="flex items-center">
                    <i class="fas fa-chevron-down filter-toggle-icon text-lg"></i>
                </div>
            </div>
            
            <!-- Active filters summary -->
            {% if filtros_ativos.status or filtros_ativos.pesquisador or filtros_ativos.codigo or filtros_ativos.ponto or filtros_ativos.data or filtros_ativos.padrao or filtros_ativos.id %}
            <div class="filter-summary mt-3 pt-3 border-t border-blue-500">
                {% if filtros_ativos.status %}
                    <span class="filter-summary-tag">Status: {{ filtros_ativos.status }}</span>
                {% endif %}
                {% if filtros_ativos.pesquisador %}
                    <span class="filter-summary-tag">Pesquisador: {{ filtros_ativos.pesquisador }}</span>
                {% endif %}
                {% if filtros_ativos.codigo %}
                    <span class="filter-summary-tag">Código: {{ filtros_ativos.codigo }}</span>
                {% endif %}
                {% if filtros_ativos.ponto %}
                    <span class="filter-summary-tag">Ponto: {{ filtros_ativos.ponto }}</span>
                {% endif %}
                {% if filtros_ativos.data %}
                    <span class="filter-summary-tag">Data: {{ filtros_ativos.data }}</span>
                {% endif %}
                {% if filtros_ativos.padrao %}
                    <span class="filter-summary-tag">Padrão: {{ filtros_ativos.padrao }}</span>
                {% endif %}
            </div>
            {% endif %}
        </div>
        
        <!-- Expandable Filter Content -->
        <div class="filter-content" id="filter-content">
            <div class="p-6 bg-gray-800">
                <form method="get" id="filter-form" class="space-y-6">
                    <!-- First Row -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="filter-group">
                            <label class="block text-sm font-semibold text-gray-200 mb-2">
                                <i class="fas fa-toggle-on mr-2 text-blue-400"></i>Status
                            </label>
                            <select name="status" class="w-full px-4 py-3 border-2 border-gray-600 rounded-lg focus:border-blue-400 focus:ring-2 focus:ring-blue-900 transition-all duration-200 bg-gray-700 text-gray-100">
                                <option value="">Todos os Status</option>
                                <option value="aguardando" {% if filtros_ativos.status == 'aguardando' %}selected{% endif %}>Aguardando</option>
                                <option value="em_andamento" {% if filtros_ativos.status == 'em_andamento' %}selected{% endif %}>Em Andamento</option>
                                <option value="concluida" {% if filtros_ativos.status == 'concluida' %}selected{% endif %}>Concluída</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="block text-sm font-semibold text-gray-200 mb-2">
                                <i class="fas fa-user mr-2 text-green-400"></i>Pesquisador
                            </label>
                            <select name="usuario" class="filter-select select2 w-full px-4 py-3 border-2 border-gray-600 rounded-lg focus:border-blue-400 focus:ring-2 focus:ring-blue-900 transition-all duration-200 bg-gray-700 text-gray-100">
                                <option value="">Todos os Pesquisadores</option>
                                {% for pesquisador in pesquisadores %}
                                    <option value="{{ pesquisador.username }}" {% if filtros_ativos.pesquisador == pesquisador.username %}selected{% endif %}>
                                        {{ pesquisador.username }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                    </div>
                    
                    <!-- Second Row -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="filter-group">
                            <label class="block text-sm font-semibold text-gray-200 mb-2">
                                <i class="fas fa-code mr-2 text-orange-400"></i>Código
                            </label>
                            <select name="codigo" id="codigo-select" class="filter-select select2 w-full px-4 py-3 border-2 border-gray-600 rounded-lg focus:border-blue-400 focus:ring-2 focus:ring-blue-900 transition-all duration-200 bg-gray-700 text-gray-100">
                                <option value="">Todos os Códigos</option>
                                {% for codigo in codigos %}
                                    <option value="{{ codigo }}" {% if filtros_ativos.codigo == codigo %}selected{% endif %}>
                                        {{ codigo }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="block text-sm font-semibold text-gray-200 mb-2">
                                <i class="fas fa-map-marker-alt mr-2 text-red-400"></i>Ponto
                                <span class="text-xs text-gray-400 ml-1">(Filtre por código primeiro)</span>
                            </label>
                            <div class="relative">
                                <select name="ponto" id="ponto-select" class="filter-select select2 w-full px-4 py-3 border-2 border-gray-600 rounded-lg focus:border-blue-400 focus:ring-2 focus:ring-blue-900 transition-all duration-200 bg-gray-700 text-gray-100">
                                    <option value="">Todos os Pontos</option>
                                    {% for ponto in pontos %}
                                        <option value="{{ ponto }}" {% if filtros_ativos.ponto == ponto %}selected{% endif %}>
                                            {{ ponto }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Third Row -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="filter-group">
                            <label class="block text-sm font-semibold text-gray-200 mb-2">
                                <i class="fas fa-calendar mr-2 text-indigo-400"></i>Data
                            </label>
                            <select name="data" class="filter-select select2 w-full px-4 py-3 border-2 border-gray-600 rounded-lg focus:border-blue-400 focus:ring-2 focus:ring-blue-900 transition-all duration-200 bg-gray-700 text-gray-100">
                                <option value="">Todas as Datas</option>
                                {% for data in datas %}
                                    <option value="{{ data }}" {% if filtros_ativos.data == data %}selected{% endif %}>
                                        {{ data }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="block text-sm font-semibold text-gray-200 mb-2">
                                <i class="fas fa-chart-line mr-2 text-teal-400"></i>Padrão
                            </label>
                            <select name="padrao" class="filter-select select2 w-full px-4 py-3 border-2 border-gray-600 rounded-lg focus:border-blue-400 focus:ring-2 focus:ring-blue-900 transition-all duration-200 bg-gray-700 text-gray-100">
                                <option value="">Todos os Padrões</option>
                                {% for pattern_type in padroes %}
                                    <option value="{{ pattern_type }}" {% if filtros_ativos.padrao == pattern_type %}selected{% endif %}>
                                        {{ pattern_type }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <input type="hidden" name="sort" id="sort-field" value="{{ current_sort|default:'-id' }}">
                    
                    <!-- Active Filters Display -->
                    {% if filtros_ativos.status or filtros_ativos.pesquisador or filtros_ativos.codigo or filtros_ativos.ponto or filtros_ativos.data or filtros_ativos.padrao %}
                    <div class="border-t border-gray-600 pt-6">
                        <h3 class="text-sm font-semibold text-gray-200 mb-3">Filtros Ativos:</h3>
                        <div class="flex flex-wrap gap-2">
                            {% if filtros_ativos.status %}
                                <div class="filter-tag">
                                    <span>Status: {{ filtros_ativos.status }}</span>
                                    <i class="fas fa-times" onclick="removeFilter('status')"></i>
                                </div>
                            {% endif %}
                            {% if filtros_ativos.pesquisador %}
                                <div class="filter-tag">
                                    <span>Pesquisador: {{ filtros_ativos.pesquisador }}</span>
                                    <i class="fas fa-times" onclick="removeFilter('usuario')"></i>
                                </div>
                            {% endif %}
                            {% if filtros_ativos.codigo %}
                                <div class="filter-tag">
                                    <span>Código: {{ filtros_ativos.codigo }}</span>
                                    <i class="fas fa-times" onclick="removeFilter('codigo')"></i>
                                </div>
                            {% endif %}
                            {% if filtros_ativos.ponto %}
                                <div class="filter-tag">
                                    <span>Ponto: {{ filtros_ativos.ponto }}</span>
                                    <i class="fas fa-times" onclick="removeFilter('ponto')"></i>
                                </div>
                            {% endif %}
                            {% if filtros_ativos.data %}
                                <div class="filter-tag">
                                    <span>Data: {{ filtros_ativos.data }}</span>
                                    <i class="fas fa-times" onclick="removeFilter('data')"></i>
                                </div>
                            {% endif %}
                            {% if filtros_ativos.padrao %}
                                <div class="filter-tag">
                                    <span>Padrão: {{ filtros_ativos.padrao }}</span>
                                    <i class="fas fa-times" onclick="removeFilter('padrao')"></i>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Action Buttons -->
                    <div class="flex justify-end gap-4 pt-6 border-t border-gray-600">
                        <button type="button" onclick="resetFilters()" class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg transition-all duration-200 transform hover:scale-105 flex items-center gap-2">
                            <i class="fas fa-undo"></i>
                            Limpar Filtros
                        </button>
                        <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-all duration-200 transform hover:scale-105 flex items-center gap-2">
                            <i class="fas fa-search"></i>
                            Aplicar Filtros
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Enhanced Data Table -->
    <div class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="table-modern min-w-full">
                <thead>
                    <tr>
                        <th onclick="sortTable('id')" class="cursor-pointer hover:bg-gray-700 transition-colors {% if request.GET.sort == 'id' or request.GET.sort == '-id' or not request.GET.sort %}sort-active{% endif %}">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-hashtag mr-2"></i>ID</span>
                                {% if request.GET.sort == 'id' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-id' or not request.GET.sort %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th onclick="sortTable('codigo')" class="cursor-pointer hover:bg-gray-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-code mr-2"></i>Código</span>
                                {% if request.GET.sort == 'codigo' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-codigo' %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th onclick="sortTable('ponto')" class="cursor-pointer hover:bg-gray-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-map-marker-alt mr-2"></i>Ponto</span>
                                {% if request.GET.sort == 'ponto' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-ponto' %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th onclick="sortTable('data')" class="cursor-pointer hover:bg-gray-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-calendar mr-2"></i>Data</span>
                                {% if request.GET.sort == 'data' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-data' %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th onclick="sortTable('horario_inicio')" class="cursor-pointer hover:bg-gray-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-clock mr-2"></i>Início</span>
                                {% if request.GET.sort == 'horario_inicio' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-horario_inicio' %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th onclick="sortTable('horario_fim')" class="cursor-pointer hover:bg-gray-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-clock mr-2"></i>Fim</span>
                                {% if request.GET.sort == 'horario_fim' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-horario_fim' %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th onclick="sortTable('padrao')" class="cursor-pointer hover:bg-gray-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-chart-line mr-2"></i>Padrão</span>
                                {% if request.GET.sort == 'padrao' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-padrao' %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th onclick="sortTable('status')" class="cursor-pointer hover:bg-gray-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-toggle-on mr-2"></i>Status</span>
                                {% if request.GET.sort == 'status' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-status' %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th>
                            <span><i class="fas fa-arrows-alt mr-2"></i>Movimentos</span>
                        </th>
                        <th onclick="sortTable('criado_por')" class="cursor-pointer hover:bg-gray-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-user mr-2"></i>Criado Por</span>
                                {% if request.GET.sort == 'criado_por' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-criado_por' %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th onclick="sortTable('created_at')" class="cursor-pointer hover:bg-gray-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-calendar-plus mr-2"></i>Criação</span>
                                {% if request.GET.sort == 'created_at' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-created_at' %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th onclick="sortTable('updated_at')" class="cursor-pointer hover:bg-gray-700 transition-colors">
                            <div class="flex items-center justify-between">
                                <span><i class="fas fa-calendar-check mr-2"></i>Finalizada em</span>
                                {% if request.GET.sort == 'updated_at' %}
                                    <i class="fas fa-sort-up sort-icon"></i>
                                {% elif request.GET.sort == '-updated_at' %}
                                    <i class="fas fa-sort-down sort-icon"></i>
                                {% else %}
                                    <i class="fas fa-sort sort-icon"></i>
                                {% endif %}
                            </div>
                        </th>
                        <th>
                            <span><i class="fas fa-cog mr-2"></i>Ações</span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for sessao in sessoes %}
                    <tr class="hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 transition-all duration-200">
                        <td class="font-mono text-sm">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-800 text-blue-100">
                                #{{ sessao.sessao_id }}
                            </span>
                        </td>
                        <td>
                            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                {{ sessao.sessao.codigo }}
                            </span>
                        </td>
                        <td class="text-gray-700">{{ sessao.sessao.ponto }}</td>
                        <td class="text-gray-700">{{ sessao.sessao.data|default:"-" }}</td>
                        <td class="text-gray-700">{{ sessao.sessao.horario_inicio|default:"-" }}</td>
                        <td class="text-gray-700">
                            {% if sessao.sessao.horario_fim and sessao.sessao.horario_fim != "" %}
                                {{ sessao.sessao.horario_fim }}
                            {% else %}
                                {% if sessao.sessao.status == "Concluída" %}
                                    <span class="text-gray-400 italic">Não definido</span>
                                {% else %}
                                    <span class="text-blue-600 italic">Em andamento</span>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="text-gray-700">{{ sessao.sessao.padrao }}</td>
                        <td>
                            {% if sessao.sessao.status == "Aguardando" or sessao.sessao.status == "Em andamento" %}
                                <span class="status-badge status-active">
                                    {{ sessao.sessao.status }}
                                </span>
                            {% else %}
                                <span class="status-badge status-finished">
                                    {{ sessao.sessao.status }}
                                </span>
                            {% endif %}
                        </td>
                        <td>
                            {% if sessao.movimentos %}
                                <div class="flex flex-wrap gap-1">
                                    {% for movimento in sessao.movimentos %}
                                        <span class="movement-badge">{{ movimento }}</span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <span class="text-gray-400 italic">Nenhum</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="flex items-center">
                                <div class="h-8 w-8 rounded-full bg-gray-600 flex items-center justify-center mr-2">
                                    <span class="text-xs font-medium text-gray-100">
                                        {{ sessao.sessao.criado_por.username|make_list|first|upper }}
                                    </span>
                                </div>
                                <span class="text-sm text-gray-100 font-medium">{{ sessao.sessao.criado_por.username }}</span>
                            </div>
                        </td>
                        <td class="text-sm text-gray-600">{{ sessao.sessao.created_at|date:"d/m/Y H:i"|default:"-" }}</td>
                        <td class="text-sm text-gray-600">
                            {% if sessao.sessao.status == "Concluída" %}
                                {{ sessao.sessao.updated_at|date:"H:i"|default:"-" }}
                                <br>
                                <span class="text-xs text-gray-500">{{ sessao.sessao.updated_at|date:"d/m/Y" }}</span>
                            {% else %}
                                <span class="text-gray-400 italic">Em andamento</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="action-menu">
                                <button class="action-btn js-toggle-menu">
                                    <i class="fas fa-ellipsis-v"></i>
                                    <span>Ações</span>
                                </button>
                                <div class="action-dropdown">
                                    <a href="{% url 'detalhes_sessao' sessao.sessao_id %}" class="dropdown-item" onclick="console.log('Clicking details for session:', {{ sessao.sessao_id }}); return true;">
                                        <i class="fas fa-eye text-blue-500"></i>
                                        Ver Detalhes
                                    </a>
                                    {% if sessao.sessao.status == "Aguardando" or sessao.sessao.status == "Em andamento" %}
                                    <div class="dropdown-item danger js-finalizar" data-sessao-id="{{ sessao.sessao_id }}">
                                        <i class="fas fa-stop-circle"></i>
                                        Finalizar Sessão
                                    </div>
                                    {% endif %}
                                    <div class="dropdown-item js-exportar" data-sessao-id="{{ sessao.sessao_id }}">
                                        <i class="fas fa-file-csv text-green-500"></i>
                                        Exportar CSV
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="12" class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>Nenhuma sessão encontrada</h3>
                            <p>Não foi possível encontrar sessões com os filtros aplicados.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Enhanced Pagination -->
    {% if sessoes.paginator.num_pages > 1 %}
    <div class="pagination-modern">
        {% if sessoes.has_previous %}
            <a href="?page=1{% if current_sort %}&sort={{ current_sort }}{% endif %}{% for key, value in filtros_ativos.items %}{% if value %}&{{ key }}={{ value }}{% endif %}{% endfor %}" 
               class="pagination-btn">
                <i class="fas fa-angle-double-left"></i>
            </a>
            <a href="?page={{ sessoes.previous_page_number }}{% if current_sort %}&sort={{ current_sort }}{% endif %}{% for key, value in filtros_ativos.items %}{% if value %}&{{ key }}={{ value }}{% endif %}{% endfor %}" 
               class="pagination-btn">
                <i class="fas fa-angle-left"></i>
            </a>
        {% endif %}

        <span class="pagination-info">
            Página {{ sessoes.number }} de {{ sessoes.paginator.num_pages }}
        </span>

        {% if sessoes.has_next %}
            <a href="?page={{ sessoes.next_page_number }}{% if current_sort %}&sort={{ current_sort }}{% endif %}{% for key, value in filtros_ativos.items %}{% if value %}&{{ key }}={{ value }}{% endif %}{% endfor %}" 
               class="pagination-btn">
                <i class="fas fa-angle-right"></i>
            </a>
            <a href="?page={{ sessoes.paginator.num_pages }}{% if current_sort %}&sort={{ current_sort }}{% endif %}{% for key, value in filtros_ativos.items %}{% if value %}&{{ key }}={{ value }}{% endif %}{% endfor %}" 
               class="pagination-btn">
                <i class="fas fa-angle-double-right"></i>
            </a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    // Passa dados do Django para JavaScript
    window.filtrosAtivos = {
        {% if filtros_ativos.ponto %}ponto: "{{ filtros_ativos.ponto|escapejs }}"{% else %}ponto: ""{% endif %}
    };
    
    window.originalPontos = [
        {% for ponto in pontos %}"{{ ponto|escapejs }}"{% if not forloop.last %},{% endif %}{% endfor %}
    ];
</script>
<script src="{% static 'js/pages/sessoes.js' %}"></script>
{% endblock %}